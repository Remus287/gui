<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<canvas id="liveChart" width="400" height="200"></canvas>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // Get the canvas element and context
    var canvas = document.getElementById('liveChart');
    var ctx = canvas.getContext('2d');

    // Set up the initial data
    var data = {
        labels: [],
        datasets: [{
            label: 'Sensor Data',
            borderColor: 'rgba(75, 192, 192, 1)',
            borderWidth: 2,
            data: [],
            fill: false
        }]
    };

    // Set up the chart options
    var options = {
        responsive: true,
        scales: {
            x: {
                type: 'linear',
                position: 'bottom'
            }
        }
    };

    // Create the chart
    var liveChart = new Chart(ctx, {
        type: 'line',
        data: data,
        options: options
    });

    // Function to update the chart with new data
    function updateChart(newData) {
        // Add new data to the chart
        liveChart.data.labels.push(newData.label);
        liveChart.data.datasets[0].data.push(newData.trial);

        // Remove old data if the length exceeds a certain limit
        var maxLength = 10;
        if (liveChart.data.labels.length > maxLength) {
            liveChart.data.labels.shift();
            liveChart.data.datasets[0].data.shift();
        }

        // Update the chart
        liveChart.update();
    }

    // Function to fetch data from the server
    function fetchData() {
        fetch('/sensor_data3')
            .then(response => response.json())
            .then(data => {
                // Update the chart with the new data
                updateChart({ label: data.time, trial: liveChart.data.labels.length + 1 });
            })
            .catch(error => console.error('Error fetching data:', error))
            .finally(() => {
                // Schedule the next data fetch after a delay (e.g., 1000 ms)
                setTimeout(fetchData, 5);
            });
    }

    // Start fetching data when the page is loaded
    fetchData();
});
</script>

</body>
</html>
